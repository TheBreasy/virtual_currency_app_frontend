const base_url="https://exchange-nodejs.herokuapp.com";localStorage.getItem("token")||(window.location.href="login.html");const recipient=document.querySelector("#recipient"),autocomplete=document.querySelector("#autocomplete"),searchName=async o=>{let e=await fetch(base_url+"/users/",{method:"get",headers:{"Content-Type":"application/json"}});let t=(await e.json()).users,n=t.filter(e=>{var t=new RegExp(`^${o}`,"gi");return e.nickname.match(t)});0===o.length&&(n=[],document.querySelector("#autocomplete").innerHTML=""),outputHtml(n)},outputHtml=e=>{var t;0<e.length&&(t=e.map(e=>`
                    <div class="pt-1">
                        <a class="color-blue autofill">${e.nickname}</a>
                    </div>
                `).join(""),autocomplete.innerHTML=t,console.log(e),console.log(t),document.querySelectorAll(".autofill").forEach(e=>{e.addEventListener("click",e=>{console.log("clicked"),e.preventDefault(),document.querySelector("#recipient").value=document.querySelector(".autofill").innerHTML})}))};recipient.addEventListener("input",()=>searchName(recipient.value)),primus=Primus.connect(base_url+"/js/primus.js",{reconnect:{max:1/0,min:500,retries:10}}),document.querySelector("#send").addEventListener("click",()=>{var e=document.querySelector("#recipient").value,t=parseInt(document.querySelector("#amount").value),o=document.querySelector("#reason").value,n=document.querySelector("#message").value;fetch(base_url+"/api/v1/transfers",{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({recipient:e,amount:t,reason:o,message:n})}).then(e=>e.json()).then(t=>{if("success"===t.status)primus.write({action:"addTransfer",data:t}),window.location.href="index.html";else{let e=document.querySelector(".card__alert");e.textContent=t.message,e.classList.remove("hidden")}}).catch(e=>{console.log(e)})});